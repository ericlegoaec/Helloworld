{% extends "base.html" %}
{% load humanize %}

{% block sidebar %}
<li class="active"><a href="/">Overview</a></li>
<li><a href="{% url 'upload:pf_update' %}">Uploads</a></li>
<li><a href="#">Analytics</a></li>
<li><a href="#">Export</a></li>
{% endblock %}

{% block login %}
  {% if not uname %}
  <li><a href="{% url 'accounts:login' %}">Login</a></li>
  <li><a href="{% url 'accounts:register' %}">Register</a></li>
  {% else %}
  <li><a>Welcome: {{ uname }}</a></li>
  <li><a href="{% url 'accounts:logout' %}">Logout</a></li>
  {% endif %}
{% endblock %}

{% block content %}
{% if uname %}
<h2 class="sub-header">Summary</h2>

<form role="form" method="post" action="{% url 'date_querry' %}">
<!-- 日期选择 -->
<div class="row center-block">
  <label class="col-md-2 control-label">Date Picking</label>
  <div class="col-xs-2">
    <input id="dp" name="dp" class="form-control" type="text" value="" placeholder="Enter date">
  </div>
  <button type="submit" class="btn btn-default">Submit</button>
</div>
</form>

<br />

<div><h3>Portfolio</h3></div>
<div class="table-responsive">
{% if pf_id %}
Portfolio Name > {{ pf_id }}
  <table class="table table-striped table-bordered table-hover">
    <thead>
      <tr>
        <th>Stock Code</th>
        <th>Company Name</th>
        <th>Sector</th>
        <th>Industry Group</th>
        <th>Direction</th>
        <th>Quantity</th>
        <th>Current Price</th>
        <th>Capital</th>
        <th>P&L</th>
        <th>P&L %</th>
        <th>MTD</th>
        <th>Inception</th>
      </tr>
    </thead>
    <tbody>
      {% for row in portfolio_list %}
      <tr>
        <td>{{ row.stock_id }}</td>
        <td>{{ row.name }}</td>
        <td>{{ row.sector }}</td>
        <td>{{ row.industry }}</td>
        <td>{{ row.direction }}</td>
        <td>{{ row.quantity|intcomma}}</td>
        <td>{{ row.price|floatformat:2 }}</td>
        <td>{{ row.capital|intcomma }}</td>
        <td>{{ row.pal|intcomma }}</td>
        <td>{{ row.palp|floatformat:2 }}</td>
        <td>{{ row.mtd }}</td>
        <td>{{ row.inception }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <table class="table table-striped table-bordered table-hover">
    <thead>
      <tr>
        <th>Portfolio</th>
        <th>Current</th>
        <th>MTD</th>
        <th>Since Inception</th>
      </tr>
    </thead>
    <tbody>
      {% for pf in pf_list %}
      <tr>
        <td><a href="{% url 'pf_detail' pf.pf_id %}">{{ pf.pf_id }}</a></td>
        <td>{{ pf.pal }}</td>
        <td>{{ pf.mtd }}</td>
        <td>{{ pf.inception }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}
</div>

<h2 class="sub-header">Test</h2>
<!-- Show Detailed Portfolio -->
<div><h3>Portfolio</h3></div>
<div class="table-responsive">
  <table class="table table-striped table-bordered table-hover">
    <thead>
      <tr>
        <th>Date</th>
        <th>Portfolio</th>
        <th>Stock</th>
        <th>Quantity</th>
        <th>Price</th>
        <th>Stock Sum</th>
        <th>App Fee</th>
      </tr>
    </thead>
    <tbody>
      {% for row in portfolio_list %}
      <tr>
        <td>{{ row.date|date:"Y-m-d" }}</td>
        <td>{{ row.pf_id }}</td>
        <td>{{ row.stock_id }}</td>
        <td>{{ row.quantity|intcomma }}</td>
        <td>{{ row.price }}</td>
        <td>{{ row.stock_sum|intcomma }}</td>
        <td>{{ row.app_fee|intcomma }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Show Detailed Trade -->
<div><h3>Trade</h3></div>
<div class="table-responsive">
  <table class="table table-striped table-bordered table-hover">
    <thead>
      <tr>
        <th>Date</th>
        <th>Portfolio</th>
        <th>Stock</th>
        <th>Quantity</th>
        <th>Price</th>
      </tr>
    </thead>
    <tbody>
      {% for row in trade_list %}
      <tr>
        <td>{{ row.date|date:"Y-m-d" }}</td>
        <td>{{ row.pf_id }}</td>
        <td>{{ row.stock_id }}</td>
        <td>{{ row.quantity|intcomma }}</td>
        <td>{{ row.price }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


{% endif %}
{% endblock %}


{% block js %}
<script>
$('#dp').datetimepicker({
    language:  'eng',
    weekStart: 1,
    todayBtn:  1,
    autoclose: 1,
    todayHighlight: 1,
    startView: 2,
    minView: 2,
    forceParse: 0,
    format: 'yyyy-mm-dd'
});

// $('#dp').datetimepicker().on('changeDate', function(ev){
//   alert("Hi!");
// })
</script>
{% endblock %}